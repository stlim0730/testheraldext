var optimizelyBackup1 = {
  "activeExperiments": [
    "6360074345"
  ],
  "allExperiments": {
    "6334365568": {
      "conditional_code":"$( \".postid-10255069\" ).length > 0",
      "activation_mode":"conditional",
      "name":"Wordpress [10255069]: Baby-crazy women are begging Donor Dad for his famous sperm",
      "variation_ids": [
        "6339376997",
        "6339376998",
        "6337600152",
        "6332552227",
        "6336333260"
      ],
      "urls": [
        {
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids": [
        "6339376997",
        "6339376998",
        "6337600152",
        "6332552227",
        "6336333260"
      ]
    },
    "6360074345": {
      "conditional_code":"$( \".postid-10259320\" ).length > 0",
      "variation_weights": {
        "6354613503":2000,
        "6354613502":2000,
        "6368451156":2000,
        "6363604303":2000,
        "6367023442":2000
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10259320]: You can now major in 'Moneyball'",
      "enabled":true,
      "variation_ids": [
        "6354613502",
        "6354613503",
        "6367023442",
        "6368451156",
        "6363604303"
      ],
      "urls": [
        {
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids": [
        "6354613502",
        "6354613503",
        "6367023442",
        "6368451156",
        "6363604303"
      ]
    }
  },
  "all_experiments": {
    "6334365568": {
      "conditional_code":"$( \".postid-10255069\" ).length > 0",
      "activation_mode":"conditional",
      "name":"Wordpress [10255069]: Baby-crazy women are begging Donor Dad for his famous sperm",
      "variation_ids": [
        "6339376997",
        "6339376998",
        "6337600152",
        "6332552227",
        "6336333260"
      ],
      "urls": [
        {
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids": [
        "6339376997",
        "6339376998",
        "6337600152",
        "6332552227",
        "6336333260"
      ]
    },
    "6360074345": {
      "conditional_code":"$( \".postid-10259320\" ).length > 0",
      "variation_weights": {
        "6354613503":2000,
        "6354613502":2000,
        "6368451156":2000,
        "6363604303":2000,
        "6367023442":2000
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10259320]: You can now major in 'Moneyball'",
      "enabled":true,
      "variation_ids": [
        "6354613502",
        "6354613503",
        "6367023442",
        "6368451156",
        "6363604303"
      ],
      "urls": [
        {
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids": [
        "6354613502",
        "6354613503",
        "6367023442",
        "6368451156",
        "6363604303"
      ]
    }
  },
  "allVariations": {
    "6354613503": {
      "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"How to strike it rich in baseball without ever playing\");",
      "name":"How to strike it rich in baseball without ever playing"
    },
    "6332552227": {
      "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Serial sperm donor is going to have a lot more kids soon\");",
      "name":"Serial sperm donor is going to have a lot more kids soon"
    },
    "6339376997": {
      "name":"Original"
    },
    "6339376998": {
      "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Women are fighting to get a piece of the Sperminator\");",
      "name":"Women are fighting to get a piece of the Sperminator"
    },
    "6336333260": {
      "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Prolific sperm donor has a huge fan club\");",
      "name":"Prolific sperm donor has a huge fan club"
    },
    "6363604303": {
      "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Now you can get a degree for geeking out on sports stats\");",
      "name":"Now you can get a degree for geeking out on sports stats"
    },
    "6367023442": {
      "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Finally, a college major for sports stats geeks\");",
      "name":"Finally, a college major for sports stats geeks"
    },
    "6368451156": {
      "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Syracuse wants to develop the next generation of 'Moneyball' executives\");",
      "name":"Syracuse wants to develop the next generation of 'Moneyball' executives"
    },
    "6337600152": {
      "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Women lining up for serial sperm donor’s goods\");",
      "name":"Women lining up for serial sperm donor’s goods"
    },
    "6354613502": {
      "name":"Original"
    }
  },
  "revision":6553,
  "variationIdsMap": {
    "6360074345": [
      "6367023442"
    ]
  },
  "variation_map": {
    "6360074345":2
  },
  "variationMap": {
    "6360074345":2
  },
  "variationNamesMap": {
    "6360074345":"Finally, a college major for sports stats geeks"
  },
  "data": {
    "audiences": {
      "2690270357": {
        "conditions": [
          "and",
          [
            "or",
            [
              "or",
              {
                "dimension_id":2593380160,
                "value":"desktop"
              },
              {
                "dimension_id":2593380160,
                "value":"ipad"
              },
              {
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ]
          ]
        ],
        "name":"Desktop only",
        "segment_id":2664470705
      },
      "2840320495": {
        "conditions": [
          "and",
          [
            "or",
            [
              "or",
              {
                "dimension_id":2830940549
              }
            ]
          ]
        ],
        "name":"New Visitors",
        "segment_id":2816530250
      },
      "2846450017": {
        "conditions": [
          "and",
          [
            "or",
            [
              "not",
              [
                "or",
                {
                  "dimension_id":2830940549
                }
              ]
            ]
          ]
        ],
        "name":"Returning Visitors",
        "segment_id":2815550413
      },
      "2854090004": {
        "conditions": [
          "and",
          [
            "or",
            [
              "or",
              {
                "dimension_id":2862580005,
                "value":"US|NY|NEWYORK"
              }
            ]
          ]
        ],
        "name":"NYC",
        "segment_id":2851680020
      },
      "2870970152": {
        "conditions": [
          "and",
          [
            "or",
            [
              "or",
              {
                "dimension_id":2593380160,
                "value":"desktop"
              }
            ],
            [
              "or",
              {
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ],
            [
              "or",
              {
                "dimension_id":2593380160,
                "value":"ipad"
              }
            ]
          ],
          [
            "or",
            [
              "or",
              {
                "dimension_id":2855410187,
                "value":"true",
                "match":"exact"
              }
            ]
          ]
        ],
        "name":"Desktop only + Test cookie",
        "segment_id":2865290708
      }
    },
    "thirdParty": {

    },
    "experiments": {
      "6334365568": {
        "code":"",
        "name":"Wordpress [10255069]: Baby-crazy women are begging Donor Dad for his famous sperm",
        "conditional":true,
        "manual":false,
        "section_ids": [

        ],
        "variation_ids": [
          "6339376997",
          "6339376998",
          "6337600152",
          "6332552227",
          "6336333260"
        ]
      },
      "6360074345": {
        "code":"",
        "name":"Wordpress [10259320]: You can now major in 'Moneyball'",
        "conditional":true,
        "manual":false,
        "section_ids": [

        ],
        "variation_ids": [
          "6354613502",
          "6354613503",
          "6367023442",
          "6368451156",
          "6363604303"
        ]
      }
    },
    "segments": {
      "298873633": {
        "name":"Source Type"
      },
      "298928413": {
        "name":"Browser"
      },
      "299044025": {
        "name":"Mobile Visitors"
      },
      "2250462273": {
        "name":"Campaign"
      },
      "2664470705": {
        "name":"Desktop only"
      },
      "2815550413": {
        "name":"Returning Visitors"
      },
      "2816530250": {
        "name":"New Visitors"
      },
      "2851680020": {
        "name":"NYC"
      },
      "2865290708": {
        "name":"Desktop only + Test cookie"
      }
    },
    "sections": {

    },
    "variations": {
      "6354613503": {
        "name":"How to strike it rich in baseball without ever playing",
        "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"How to strike it rich in baseball without ever playing\");"
      },
      "6332552227": {
        "name":"Serial sperm donor is going to have a lot more kids soon",
        "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Serial sperm donor is going to have a lot more kids soon\");"
      },
      "6339376997": {
        "name":"Original",
        "code":""
      },
      "6339376998": {
        "name":"Women are fighting to get a piece of the Sperminator",
        "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Women are fighting to get a piece of the Sperminator\");"
      },
      "6336333260": {
        "name":"Prolific sperm donor has a huge fan club",
        "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Prolific sperm donor has a huge fan club\");"
      },
      "6363604303": {
        "name":"Now you can get a degree for geeking out on sports stats",
        "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Now you can get a degree for geeking out on sports stats\");"
      },
      "6367023442": {
        "name":"Finally, a college major for sports stats geeks",
        "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Finally, a college major for sports stats geeks\");"
      },
      "6368451156": {
        "name":"Syracuse wants to develop the next generation of 'Moneyball' executives",
        "code":"$(\"h1 > .postid-10259320, h3.postid-10259320, h2.postid-10259320\").text(\"Syracuse wants to develop the next generation of 'Moneyball' executives\");"
      },
      "6337600152": {
        "name":"Women lining up for serial sperm donor’s goods",
        "code":"$(\"h1 > .postid-10255069, h3.postid-10255069, h2.postid-10255069\").text(\"Women lining up for serial sperm donor’s goods\");"
      },
      "6354613502": {
        "name":"Original",
        "code":""
      }
    },
    "visitor": {
      "browser":"Chrome",
      "browserVersion":"51.0.2704.103",
      "device":"unknown",
      "deviceType":"desktop",
      "platform": {
        "id":"mac os",
        "version":"10.11.5"
      },
      "mobile":false,
      "mobileId":"unknown",
      "os":"mac os",
      "lists": {

      },
      "location": {
        "continent":"NA",
        "country":"US",
        "region":"NY",
        "city":"NEWYORK"
      },
      "ip":"104.247.35.210",
      "matchingRules":null,
      "referrer":"",
      "segments": {
        "298873633":"search",
        "298928413":"gc",
        "299044025":"false",
        "2250462273":"none",
        "2664470705":"true",
        "2815550413":"true",
        "2816530250":"true",
        "2851680020":"true"
      },
      "dimensions": {

      },
      "audiences": {
        "2690270357":true,
        "2840320495":true,
        "2846450017":true,
        "2854090004":true,
        "2870970152":false
      },
      "params": {
        "":""
      }
    },
    "state": {
      "activeExperiments": [
        "6360074345"
      ],
      "variationIdsMap": {
        "6360074345": [
          "6367023442"
        ]
      },
      "variationMap": {
        "6360074345":2
      },
      "variationNamesMap": {
        "6360074345":"Finally, a college major for sports stats geeks"
      },
      "enabled":true,
      "integrations": {
        "activeOAuthClientIds": [

        ]
      }
    }
  },
  "iapi": {

  }
};

var optimizelyBackup2 = {  
  "activeExperiments":[  
    "6405201336"
  ],
  "allExperiments":{  
    "6405201336":{  
      "conditional_code":"$( \".postid-10262545\" ).length > 0",
      "variation_weights":{  
        "6403512399":2000,
        "6403512398":2000,
        "6399660190":2000,
        "6388751002":2000,
        "6386990817":2000
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10262545]: The ugly scenes behind the blue wall of Facebook",
      "enabled":true,
      "variation_ids":[  
        "6403512398",
        "6403512399",
        "6399660190",
        "6388751002",
        "6386990817"
      ],
      "urls":[  
        {  
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids":[  
        "6403512398",
        "6403512399",
        "6399660190",
        "6388751002",
        "6386990817"
      ]
    }
  },
  "all_experiments":{  
    "6405201336":{  
      "conditional_code":"$( \".postid-10262545\" ).length > 0",
      "variation_weights":{  
        "6403512399":2000,
        "6403512398":2000,
        "6399660190":2000,
        "6388751002":2000,
        "6386990817":2000
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10262545]: The ugly scenes behind the blue wall of Facebook",
      "enabled":true,
      "variation_ids":[  
        "6403512398",
        "6403512399",
        "6399660190",
        "6388751002",
        "6386990817"
      ],
      "urls":[  
        {  
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids":[  
        "6403512398",
        "6403512399",
        "6399660190",
        "6388751002",
        "6386990817"
      ]
    }
  },
  "allVariations":{
    "6403512399":{
      "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"Working at Facebook is worse than you could imagine \");",
      "name":"Working at Facebook is worse than you could imagine "
    },
    "6386990817":{  
      "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"It's not OK to talk about your wealth at Facebook \");",
      "name":"It's not OK to talk about your wealth at Facebook"
    },
    "6399660190":{  
      "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"The ruthless, punishing life of a Facebook employee \");",
      "name":"The ruthless, punishing life of a Facebook employee "
    },
    "6388751002":{  
      "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"Insider reveals what really goes on at Facebook \");",
      "name":"Insider reveals what really goes on at Facebook "
    },
    "6403512398":{  
      "name":"Original"
    }
  },
  "revision":6598,
  "variationIdsMap":{  
    "6405201336":[  
      "6388751002"
    ]
  },
  "variation_map":{  
    "6405201336":3
  },
  "variationMap":{  
    "6405201336":3
  },
  "variationNamesMap":{  
    "6405201336":"Insider reveals what really goes on at Facebook "
  },
  "data":{  
    "audiences":{  
      "2690270357":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"desktop"
              },
              {  
                "dimension_id":2593380160,
                "value":"ipad"
              },
              {  
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ]
          ]
        ],
        "name":"Desktop only",
        "segment_id":2664470705
      },
      "2840320495":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2830940549
              }
            ]
          ]
        ],
        "name":"New Visitors",
        "segment_id":2816530250
      },
      "2846450017":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "not",
              [  
                "or",
                {  
                  "dimension_id":2830940549
                }
              ]
            ]
          ]
        ],
        "name":"Returning Visitors",
        "segment_id":2815550413
      },
      "2854090004":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2862580005,
                "value":"US|NY|NEWYORK"
              }
            ]
          ]
        ],
        "name":"NYC",
        "segment_id":2851680020
      },
      "2870970152":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"desktop"
              }
            ],
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ],
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"ipad"
              }
            ]
          ],
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2855410187,
                "value":"true",
                "match":"exact"
              }
            ]
          ]
        ],
        "name":"Desktop only + Test cookie",
        "segment_id":2865290708
      }
    },
    "thirdParty":{  

    },
    "experiments":{  
      "6405201336":{  
        "code":"",
        "name":"Wordpress [10262545]: The ugly scenes behind the blue wall of Facebook",
        "conditional":true,
        "manual":false,
        "section_ids":[  

        ],
        "variation_ids":[  
          "6403512398",
          "6403512399",
          "6399660190",
          "6388751002",
          "6386990817"
        ]
      }
    },
    "segments":{  
      "298873633":{  
        "name":"Source Type"
      },
      "298928413":{  
        "name":"Browser"
      },
      "299044025":{  
        "name":"Mobile Visitors"
      },
      "2250462273":{  
        "name":"Campaign"
      },
      "2664470705":{  
        "name":"Desktop only"
      },
      "2815550413":{  
        "name":"Returning Visitors"
      },
      "2816530250":{  
        "name":"New Visitors"
      },
      "2851680020":{  
        "name":"NYC"
      },
      "2865290708":{  
        "name":"Desktop only + Test cookie"
      }
    },
    "sections":{  

    },
    "variations":{  
      "6403512399":{  
        "name":"Working at Facebook is worse than you could imagine ",
        "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"Working at Facebook is worse than you could imagine \");"
      },
      "6386990817":{  
        "name":"It's not OK to talk about your wealth at Facebook",
        "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"It's not OK to talk about your wealth at Facebook \");"
      },
      "6399660190":{  
        "name":"The ruthless, punishing life of a Facebook employee ",
        "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"The ruthless, punishing life of a Facebook employee \");"
      },
      "6388751002":{  
        "name":"Insider reveals what really goes on at Facebook ",
        "code":"$(\"h1 > .postid-10262545, h3.postid-10262545, h2.postid-10262545\").text(\"Insider reveals what really goes on at Facebook \");"
      },
      "6403512398":{  
        "name":"Original",
        "code":""
      }
    },
    "visitor":{  
      "browser":"Chrome",
      "browserVersion":"51.0.2704.103",
      "device":"unknown",
      "deviceType":"desktop",
      "platform":{  
        "id":"mac os",
        "version":"10.11.5"
      },
      "mobile":false,
      "mobileId":"unknown",
      "os":"mac os",
      "lists":{  

      },
      "location":{  
        "continent":"NA",
        "country":"US",
        "region":"NY",
        "city":"NEWYORK"
      },
      "ip":"104.247.35.210",
      "matchingRules":null,
      "referrer":"",
      "segments":{  
        "298873633":"search",
        "298928413":"gc",
        "299044025":"false",
        "2250462273":"none",
        "2664470705":"true",
        "2815550413":"true",
        "2816530250":"true",
        "2851680020":"true"
      },
      "dimensions":{  

      },
      "audiences":{  
        "2690270357":true,
        "2840320495":true,
        "2846450017":true,
        "2854090004":true,
        "2870970152":false
      },
      "params":{  
        "":""
      }
    },
    "state":{  
      "activeExperiments":[  
        "6405201336"
      ],
      "variationIdsMap":{  
        "6405201336":[  
          "6388751002"
        ]
      },
      "variationMap":{  
        "6405201336":3
      },
      "variationNamesMap":{  
        "6405201336":"Insider reveals what really goes on at Facebook "
      },
      "enabled":true,
      "integrations":{  
        "activeOAuthClientIds":[  

        ]
      }
    }
  },
  "iapi":{  

  }
};

var optimizelyBackup3 = {  
  "activeExperiments":[  
    "6398621582"
  ],
  "allExperiments":{  
    "6398621582":{  
      "conditional_code":"$( \".postid-10262972\" ).length > 0",
      "variation_weights":{  
        "6388851353":3334,
        "6388851354":3333,
        "6402462627":3333
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10262972]: Cows cannot resist this beautiful Swedish woman",
      "enabled":true,
      "variation_ids":[  
        "6388851353",
        "6388851354",
        "6402462627"
      ],
      "urls":[  
        {  
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids":[  
        "6388851353",
        "6388851354",
        "6402462627"
      ]
    }
  },
  "all_experiments":{  
    "6398621582":{  
      "conditional_code":"$( \".postid-10262972\" ).length > 0",
      "variation_weights":{  
        "6388851353":3334,
        "6388851354":3333,
        "6402462627":3333
      },
      "activation_mode":"conditional",
      "name":"Wordpress [10262972]: Cows cannot resist this beautiful Swedish woman",
      "enabled":true,
      "variation_ids":[  
        "6388851353",
        "6388851354",
        "6402462627"
      ],
      "urls":[  
        {  
          "match":"simple",
          "value":"nypost.com"
        }
      ],
      "enabled_variation_ids":[  
        "6388851353",
        "6388851354",
        "6402462627"
      ]
    }
  },
  "allVariations":{  
    "6388851353":{  
      "name":"Original"
    },
    "6388851354":{  
      "code":"$(\"h1 > .postid-10262972, h3.postid-10262972, h2.postid-10262972\").text(\"Swedish Daenerys Targaryen calls cows instead of dragons\");",
      "name":"Swedish Daenerys Targaryen calls cows instead of dragons"
    },
    "6402462627":{  
      "code":"$(\"h1 > .postid-10262972, h3.postid-10262972, h2.postid-10262972\").text(\"This woman brings all the milkshakes to the Fjord\");",
      "name":"This woman brings all the milkshakes to the Fjord"
    }
  },
  "revision":6600,
  "variationIdsMap":{  
    "6398621582":[  
      "6388851353"
    ]
  },
  "variation_map":{  
    "6398621582":0
  },
  "variationMap":{  
    "6398621582":0
  },
  "variationNamesMap":{  
    "6398621582":"Original"
  },
  "data":{  
    "audiences":{  
      "2690270357":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"desktop"
              },
              {  
                "dimension_id":2593380160,
                "value":"ipad"
              },
              {  
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ]
          ]
        ],
        "name":"Desktop only",
        "segment_id":2664470705
      },
      "2840320495":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2830940549
              }
            ]
          ]
        ],
        "name":"New Visitors",
        "segment_id":2816530250
      },
      "2846450017":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "not",
              [  
                "or",
                {  
                  "dimension_id":2830940549
                }
              ]
            ]
          ]
        ],
        "name":"Returning Visitors",
        "segment_id":2815550413
      },
      "2854090004":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2862580005,
                "value":"US|NY|NEWYORK"
              }
            ]
          ]
        ],
        "name":"NYC",
        "segment_id":2851680020
      },
      "2870970152":{  
        "conditions":[  
          "and",
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"desktop"
              }
            ],
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"tablet"
              }
            ],
            [  
              "or",
              {  
                "dimension_id":2593380160,
                "value":"ipad"
              }
            ]
          ],
          [  
            "or",
            [  
              "or",
              {  
                "dimension_id":2855410187,
                "value":"true",
                "match":"exact"
              }
            ]
          ]
        ],
        "name":"Desktop only + Test cookie",
        "segment_id":2865290708
      }
    },
    "thirdParty":{  

    },
    "experiments":{  
      "6398621582":{  
        "code":"",
        "name":"Wordpress [10262972]: Cows cannot resist this beautiful Swedish woman",
        "conditional":true,
        "manual":false,
        "section_ids":[  

        ],
        "variation_ids":[  
          "6388851353",
          "6388851354",
          "6402462627"
        ]
      }
    },
    "segments":{  
      "298873633":{  
        "name":"Source Type"
      },
      "298928413":{  
        "name":"Browser"
      },
      "299044025":{  
        "name":"Mobile Visitors"
      },
      "2250462273":{  
        "name":"Campaign"
      },
      "2664470705":{  
        "name":"Desktop only"
      },
      "2815550413":{  
        "name":"Returning Visitors"
      },
      "2816530250":{  
        "name":"New Visitors"
      },
      "2851680020":{  
        "name":"NYC"
      },
      "2865290708":{  
        "name":"Desktop only + Test cookie"
      }
    },
    "sections":{  

    },
    "variations":{  
      "6388851353":{  
        "name":"Original",
        "code":""
      },
      "6388851354":{  
        "name":"Swedish Daenerys Targaryen calls cows instead of dragons",
        "code":"$(\"h1 > .postid-10262972, h3.postid-10262972, h2.postid-10262972\").text(\"Swedish Daenerys Targaryen calls cows instead of dragons\");"
      },
      "6402462627":{  
        "name":"This woman brings all the milkshakes to the Fjord",
        "code":"$(\"h1 > .postid-10262972, h3.postid-10262972, h2.postid-10262972\").text(\"This woman brings all the milkshakes to the Fjord\");"
      }
    },
    "visitor":{  
      "browser":"Chrome",
      "browserVersion":"51.0.2704.103",
      "device":"unknown",
      "deviceType":"desktop",
      "platform":{  
        "id":"mac os",
        "version":"10.11.5"
      },
      "mobile":false,
      "mobileId":"unknown",
      "os":"mac os",
      "lists":{  

      },
      "location":{  
        "continent":"NA",
        "country":"US",
        "region":"NY",
        "city":"NEWYORK"
      },
      "ip":"104.247.35.210",
      "matchingRules":null,
      "referrer":"",
      "segments":{  
        "298873633":"search",
        "298928413":"gc",
        "299044025":"false",
        "2250462273":"none",
        "2664470705":"true",
        "2815550413":"true",
        "2816530250":"true",
        "2851680020":"true"
      },
      "dimensions":{  

      },
      "audiences":{  
        "2690270357":true,
        "2840320495":true,
        "2846450017":true,
        "2854090004":true,
        "2870970152":false
      },
      "params":{  
        "":""
      }
    },
    "state":{  
      "activeExperiments":[  
        "6398621582"
      ],
      "variationIdsMap":{  
        "6398621582":[  
          "6388851353"
        ]
      },
      "variationMap":{  
        "6398621582":0
      },
      "variationNamesMap":{  
        "6398621582":"Original"
      },
      "enabled":true,
      "integrations":{  
        "activeOAuthClientIds":[  

        ]
      }
    }
  },
  "iapi":{  

  }
};

// function setChildTextNode(elementId, text) {
//   document.getElementById(elementId).innerText = text;
// }

// function addClickEvents(port,ids){
//   for (var i = 0; i < ids.length; i++) {
//     console.log(ids[i]);
//     var n = document.getElementById(ids[i]);
//         n.addEventListener("click", function() {
//           console.log(this.id);
//           port.postMessage({state:"eval",id: this.id});
//         return ids[i];
//       });
//   };
// }


// function populateVariationsTable(data,vars){
//   var ids = [];
//   var html = "<div id="varTable"> <table>"; 
  
//   for(id in vars){
//     var o = vars[id];
//     ids.push(id);

//     //Header Row
//     html +="<tr>";
//     for (var i = 0; i < Object.keys(o).length; i++) {
//         var k = Object.keys(o)[i];
//         html+="<th>" +"Variation ID"+"</th>";
//         if(typeof o[k] ==="undefined" || o[k] === "Original" ){}
//         else{
//           console.log(k);
//           html+="<th>" +k+"</th>";
//         }
//     }
//     html +="</tr>";

//     //Info Row
//     html +="<tr>" + "<td id=""+id+"">" +id;+ "</td>";
//     for (var i = 0; i < Object.keys(o).length; i++) {
//         var k = Object.keys(o)[i];

//         if(typeof o[k] === "undefined"|| o[k] === "Original" ){}
//         else{
//           if(Array.isArray(o[k])){
//             html+="<td>" +o[key].join(",");+ "</td>";
//           }
//           else{
//             console.log(k,o[k]);  
//             //TODO: Fix weird svg bug
//             if(o[k].indexOf("svg") == -1){
//               html+="<td>" +o[k]+ "</td>";  
//             }
            
//           }
//         }
//     }
//     html +="</tr>";
//   }
//    html += "</table></div>"
//     var d1 = document.getElementById("myTest");
//     // if(html.indexOf("svg") > -1 ){
//     //   console.log(html.substring(html.indexOf("svg"),100));
//     //   console.log("HAS SVG",html.indexOf("svg") );

//     // }
//     // else{
//       d1.insertAdjacentHTML("beforeend", html);    
//     // }
    
//   console.log(ids);
//   return ids;
// }

// function populateExperimentsTable (data,vars){
//   var ids = [];
//   var html = "<div id="experimentsTable"> <table>";

//   for(id in data){
    
//     var o = data[id];
//     html += "<tr> ";
//     for(k in Object.keys(o)){
//       var key = Object.keys(o)[k];
//       html+="<th>"
//         html+= key;
//         html+="</th>"     
//     }
//     html += "</tr> ";

//     html += "<tr> ";
//     for(k in Object.keys(o)){

//       var key = Object.keys(o)[k];
//       if(key === "enabled_variation_ids" || key === "variation_ids" ){
//         html+="<td>";
//         for (var i = 0; i < o[key].length; i++) {
//           var l = o[key][i]
//           var k = Object.keys(vars).indexOf(l);
//           var m = Object.keys(vars)[k]

//           console.log(vars[m])
//           if(typeof vars[m] !=="undefined" && vars[m].name !== "Original"){
//             console.log(l);  
//             html += "<div id="+o[key][i]+">"+ o[key][i] +"</div>";

//             if(ids.indexOf(o[key][i]) === -1){
//               ids = ids.concat(o[key])
//             }  
//           }
          
//           html+="</td>";

//         }
//       }
//       else{
//         if (Array.isArray(o[key])){

//           if(typeof o[key][0] === "object"){
//             html+="<td>"
//             html+= JSON.stringify(o[key][0]);
//             html+="</td>"  
//           }
//           else{
//             html+="<td>"
//             html+= o[key].join(",");
//             html+="</td>"  
//           }
//         }
//         else if(typeof o[key] === "object"){
//             html+="<td>"
//             html+= JSON.stringify(o[key]);
//             html+="</td>"  
//           }
//         else{
//           html+="<td>"
//           html+= o[key];
//           html+="</td>"  
//         }
//       }      
//     }

//     html += "</tr>";


//   }
//   html += "</table></div>";
//     var d1 = document.getElementById("myTest");
//     d1.insertAdjacentHTML("beforeend", html);  
//   console.log(ids);
//   return ids;
// }

// function populateExperiments (data){
//   var ids = []
//   for(id in data){
//     var html = "";
//     var o = data[id];
//     var name = "";
//     var code = "";
//     // console.log(o);
//     html += "<ul> " + o["name"];
//     for (var i = 0; i < o["enabled_variation_ids"].length; i++) {
//       console.log(Object.keys(o));
//       html += "<li id="+o["enabled_variation_ids"][i]+">"+ o["enabled_variation_ids"][i] +"</li>";

//       if(ids.indexOf(o["enabled_variation_ids"][i]) === -1){
//         ids = ids.concat(o["enabled_variation_ids"])
//       }
//     };
//     html += "</ul>"
//     var d1 = document.getElementById("myTest");
//     d1.insertAdjacentHTML("beforeend", html);  
//   }
//   return ids;
// }

// chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {

//     var port = chrome.tabs.connect(tabs[0].id,{name: "optimisely"});
//     port.postMessage({state: "init"});
//     setChildTextNode("status","Haz optimisely?");

//     port.onMessage.addListener(function(msg) {
//       // console.log(msg);
//       if(msg.state === "doing it"){
//         setChildTextNode("myTest","still looking...");
//       }
//       else if(msg.state === "variation"){
//           setChildTextNode("myTest","Yup. Here"s what we see:\r\n");
          
//           var ids = populateVariationsTable(msg.experiments, msg.variations);
//           addClickEvents(port,ids);
//           // populateExperimentsTable(msg.experiments,msg.variations);
//       }
//       else if(msg.state === "no-optimisely"){
//           setChildTextNode("myTest", "Doesn"t look like it");
//       }
//       else{
//         // for msg
//         // console.log(msg);
//       }
//     });
// });

var optimizely = null;
var activeExperiments = [];

var processOptimizely = function (obj) {
  var activeExps = [];

  obj = optimizelyBackup3;

  for (var expIndex in obj["activeExperiments"]) {

    var expId = obj["activeExperiments"][expIndex];
    var varIds = obj["allExperiments"][expId]["enabled_variation_ids"];
    var variations = [];

    for (var varIndex in varIds) {

      var varId = varIds[varIndex];
      var variation = obj["allVariations"][varId];
      variation["id"] = varId;
      variation["current"] = false;
      variation["name"] = variation["name"].trim();

      // Detect current condition
      if (variation["name"] === obj["variationNamesMap"][expId].trim()) {
        // Only one of the variations
        variation["current"] = true;
      }

      // Replacing "Original" with real name: this must happen after detecting the current condition
      if (variation["name"] === "Original") {
        variation["name"] = obj["allExperiments"][expId]["name"].split(":")[1].trim();
      }

      variations.push(variation);
    }

    var experiment = {
      id: expId,
      variations: variations
    };

    activeExps.push(experiment);
  }

  return activeExps;
};

var tabulateExperiments = function (div, results) {
  if (results.length == 0) {
    $("div.nothing-to-show").show();
    $("div.things-to-show").hide();
    return;
  }

  // console.info(activeExperiments);
  // var source = $("#experiment-template").html();
  // var template = Handlebars.compile(source);
  // $("#active-experiments").html(template(activeExperiments));

  // TODO: check if handlebars work - NO!
  // TODO: feed the data using the template

  $("div.nothing-to-show").hide();
  $("div.things-to-show").show();
};

// Print jQuery version
if (typeof jQuery != "undefined") {  
  // jQuery is loaded => print the version
  console.info("jQuery found:", jQuery.fn.jquery);
}
else {
  console.info("no jQuery");
}

var port = chrome.extension.connect();
port.postMessage({
  sender: "popup",
  receiver: "background",
  event: "init",
  target: ""
});

port.onMessage.addListener(function (msg) {

  if (msg.receiver !== "popup") return;

  console.info(msg);

  if (msg.sender === "background") {

    if (msg.event === "found optimizely") {
      optimizely = JSON.parse(msg.target);
      console.info(msg.event + ":", optimizely);
      activeExperiments = processOptimizely(optimizely);
      tabulateExperiments($("#results"), activeExperiments);
    }
  }

});

$("a.twitter-share-button").click(function (e) {
  e.preventDefault();

  var prePopulText = $(this).data("text");

  chrome.windows.create({
    url: "https://twitter.com/intent/tweet?text=" + prePopulText + "&via=ProPublica",
    width: 680,
    height: 444,
    type: "panel",
    focused: true
  }, function (newWindow) {
    console.info("tweet popup window ID:", newWindow);
  });
});
